{"version":3,"file":"simple-vue.cjs.js","sources":["../src/runtime-core/componentPublicInstance.ts","../src/runtime-core/component.ts","../src/runtime-core/vnode.ts","../src/runtime-core/h.ts","../src/runtime-core/runderer.ts","../src/runtime-core/createApp.ts"],"sourcesContent":["\nconst publicPropertiesMap = {\n  $el: (i) => i.vnode.el\n}\n\nexport const PublicInstanceProxyHandlers = {\n  get ({ _: instance }, key) {\n    if(key in instance.setupState) {\n      return instance.setupState[key]\n    }\n\n    const publicGetter = publicPropertiesMap[key]\n    // 验证publicGetter是否存在\n    if(publicGetter) {\n      return publicGetter(instance)\n    }\n  }\n}","import { PublicInstanceProxyHandlers } from \"./componentPublicInstance\"\n\nexport function createComponentInstance(vnode: any) {\n  const component = {\n    vnode,\n    type: vnode.type,\n    setupState: {},\n  }\n\n  return component\n}\n\nexport function setupComponent(instance: any) {\n  // TODO\n  // 初始化props\n  // 初始化slots\n\n  //\n  setupStatefulComponent(instance)\n}\n\nfunction setupStatefulComponent(instance: any) {\n\n  const { setup } = instance.type\n\n  // 设置代理对象\n  instance.proxy = new Proxy({ _ : instance}, PublicInstanceProxyHandlers)\n\n  if(setup) {\n    const setupResult = setup()\n    handlerSetupResult(instance, setupResult)\n  }\n}\n\nfunction handlerSetupResult(instance: any, setupResult: any) {\n  // 这里传过来的setupResult可能是个函数或对象\n\n  if(typeof setupResult === 'object') {\n    instance.setupState = setupResult\n  }\n\n  // TODO\n  // 如果是函数，则当成render函数渲染\n\n  finishComponentSetup(instance)\n}\n\nfunction finishComponentSetup(instance: any) {\n  const Component = instance.type\n\n  // if(Component.render) {\n    instance.render = Component.render\n  // }\n}\n\n","import { ShapeFlags } from \"../shared/ShapeFlags\"\n\n\nexport function createVNode(type, props?, children?) {\n  const vnode = {\n    type,\n    props,\n    children,\n    shapeFlag: getShapeFlag(type),\n    el: null\n  }\n\n  if (typeof children === 'string'){\n    vnode.shapeFlag |= ShapeFlags.TEXT_CHILDREN\n  }\n  else if (Array.isArray(children)){\n    vnode.shapeFlag |= ShapeFlags.ARRAY_CHILDREN\n  }\n\n  return vnode\n}\n\nfunction getShapeFlag(type: any) {\n  return typeof type === 'string' ?\n    ShapeFlags.ELEMENT :  ShapeFlags.STATEFUL_COMPONENT\n}\n\n","\nimport { createVNode } from \"./vnode\";\n\nexport function h (type: any, props?: any, children?: any) {\n\n  // 创建虚拟节点\n  const vnode = createVNode(type, props, children)\n\n  return vnode\n}","import { isObject } from \"../shared/index\"\nimport { ShapeFlags } from \"../shared/ShapeFlags\"\nimport { createComponentInstance, setupComponent } from \"./component\"\nimport { h } from \"./h\"\n\n// 将虚拟节点渲染到真实dom\nexport function render(vnode, container) {\n  // patch\n\n  path(vnode, container)\n}\n\nfunction path(vnode, container) {\n  const { shapeFlag } = vnode\n  // 处理组件\n  /**\n   * 通过vnode.type判断是否是组件\n   */\n    if(shapeFlag & ShapeFlags.ELEMENT) {\n      processElement(vnode, container)\n    }\n    // 若type类型是object 则说明vnode是组件类型 调用processComponent处理组件\n    else if(shapeFlag & ShapeFlags.STATEFUL_COMPONENT) {\n      processComponent(vnode, container)\n    }\n}\n\nfunction processElement(vnode: any, container: any) {\n  mountElement(vnode, container)\n}\n\nfunction mountElement(vnode: any, container: any) {\n  const { type, props, children, shapeFlag } = vnode\n\n  const el = document.createElement(type);\n\n  vnode.el = el;\n\n  if(shapeFlag & ShapeFlags.TEXT_CHILDREN) {\n    el.textContent = children\n  }\n  else if(shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n    mountChildren(vnode, el)\n  }\n\n  for (const key in props) {\n    const _key = props[key]\n    const isOn = (key: string) => /^on[A-Z]/.test(key)\n    if (isOn(key)) {\n      const event = key.slice(2).toLowerCase()\n      el.addEventListener(event, _key)\n    }\n    else {\n      el.setAttribute(key, _key)\n    }\n  }\n\n  container.appendChild(el)\n\n}\n\nfunction mountChildren(vnode, container) {\n  vnode.children.map(v => path(v, container))\n}\n\nfunction processComponent(vnode: any, container: any) {\n  // 挂载组件\n  mountComponent(vnode, container)\n}\n\nfunction mountComponent(initialVnode: any, container: any) {\n  const instance = createComponentInstance(initialVnode)\n\n  setupComponent(instance)\n\n  setupRenderEffect(instance, initialVnode, container)\n}\n\nfunction setupRenderEffect(instance: any, initialVnode: any, container: any) {\n\n  const { proxy } = instance\n\n  // render函数\n  const subTree = instance.render.bind(proxy)(h)\n\n  // TODO\n  // 可能是templete\n\n  // vnode -> path\n  // vnode -> element -> mountElement\n  path(subTree, container)\n\n  initialVnode.el = subTree.el\n}\n","import { render } from \"./runderer\"\nimport { createVNode } from \"./vnode\"\n\n\nexport function createApp(rootComponent) {\n  return {\n    mount(domId: string) {\n      const rootContainer = document.querySelector(domId)\n      if (!rootContainer) {\n        throw new Error(`找不到指定的dom元素: ${domId}`)\n      }\n      // 先将根组件转化成虚拟节点\n      const vnode = createVNode(rootComponent)\n      // 渲染节点\n      render(vnode, rootContainer)\n    }\n  }\n}\n\n\n\n"],"names":[],"mappings":"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"}